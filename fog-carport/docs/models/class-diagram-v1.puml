@startuml

class User {
  - userId : int
  - firstName : String
  - lastName : String
  - email : String
  - hashedPassword : String
  - address : String
  - zip : String
  - city : String
  - phoneNumber : String
  - role : Role
  - createdAt : Timestamp
}

enum Role {
  CUSTOMER
  SALESREP
}

class Inquiry {
  - inquiryId : int
  - customer : User
  - carport : Carport
  - customerComment : String
}


class Offer {
  - offerId : int
  - seller : User
  - customer : User
  - carport : Carport
  - carportDrawing : CarportDrawing
  - offerDate : OfferDate
  - customerComment : String
  - status : OfferStatus
  - coveragePercentage : double
}

class OfferDate {
  - createdDate : Timestamp
  - expirationDate : Timestamp
  - final OFFER_PERIOD : Timestamp
  + isExpired() : boolean
  + calculateExpirationDate() : Timestamp
}

enum OfferStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
}

class Order {
  - orderId : int
  - offer : Offer
  - billOfMaterials : BillOfMaterials
  - orderDateTime : Timestamp
  - status : OrderStatus
  - paymentConfirmed : boolean
}

enum OrderStatus {
  PAID
  CANCELLED
}

class Carport {
  - carportId : int
  - length : int
  - width : int
  - height : int
  - roofType : RoofType
  - shed : Shed
  - hasShed : boolean
}

enum RoofType {
  FLAT
}

class Shed {
  - shedId : int
  - length : int
  - width : int
  - placement : ShedPlacement
}

enum ShedPlacement {
  LEFT
  RIGHT
  FULL_WIDTH
}

class Material {
  - materialId : int
  - name : String
  - description : String
  - materialCategory : MaterialCategory
  - materialType : MaterialType
  - length : double
  - width : double
  - height : double
  - unit : String
  - unitPrice : double
  - usage : String
}

enum MaterialType
{
POST
RAFTER
ROOF
BOARD
FASTENER
FITTING
}

enum MaterialCategory
{
 WOOD_AND_ROOFING
 FITTINGS_AND_FASTENERS
}

class BillOfMaterials {
  - bomId : int
  - materialLines : List<MaterialLine>
  - pricingDetails : PricingDetails
  + addMaterialLine(line : MaterialLine) : void
  + removeMaterialLine(line : MaterialLine) : void
  + calculateTotal() : double
}

class MaterialLine
{
  - lineId : int
  - offerId : int
  - material : Material
  - quantity : int
  - lineTotal : double
  + calculateLineTotal() : double
}

class PricingDetails {
  - costPrice : double
  - priceWithoutVAT : double
  - totalPriceWithVAT : double
}

class CarportDrawing {
  - drawingId : int
  - topViewSVG : String
  - sideViewSVG : String
}

class Svg {
  + {static} {final} SVG_TEMPLATE : String
  + {static} {final} SVG_TEMPLATE_INNER : String
  + {static} {final} SVG_RECT_TEMPLATE : String
  + {static} {final} SVG_ARROW_DEFS : String
  + {static} {final} SVG_LINE_TEMPLATE : String
  + {static} {final} SVG_TEXT_TEMPLATE : String
  + {static} {final} SVG_LINE_WITH_ARROWS_TEMPLATE : String
  - x : int
  - y : int
  - width : String
  - viewBox : String
  - svg : StringBuilder
  + Svg(x : int, y : int, width : String, viewBox : String)
  + addRectangle(x : double, y : double, height : double, width : double, style : String) : void
  + addLine(x1 : double, y1 : double, x2 : double, y2 : double) : void
  + addLineWithArrows(x1 : double, y1 : double, x2 : double, y2 : double) : void
  + addText(x : int, y : int, text : String) : void
  + addSvg(innerSvg : Svg) : void
  + addArrowDefs() : void
  + toString() : String
}

interface CarportSvg {
  + generateTopView(carport : Carport) : Svg
  + generateSideView(carport : Carport) : Svg
}

class CarportTopSvg {
  - carport : Carport
  + CarportTopSvg(carport : Carport)
  + generateTopView(carport : Carport) : Svg
  - addArrows() : void
  - addArrowText() : void
  - addFrame() : void
  - addBeams() : void
  - addRafters() : void
  - addPosts() : void
  - addMetalStraps() : void
}

class CarportSideSvg {
  - carport : Carport
  + CarportSideSvg(carport : Carport)
  + generateSideView(carport : Carport) : Svg
  - addFrame() : void
  - addBeams() : void
  - addRafters() : void
  - addPosts() : void
}


class UserMapper {
  + create(user : User) : int
  + read(userId : int) : User
  + readByEmail(email : String) : User
  + readAll() : List<User>
  + update(user : User) : void
  + delete(userId : int) : void
}

class InquiryMapper {
  + create(inquiry : Inquiry) : int
  + read(inquiryId : int) : Inquiry
  + readByCustomerId(customerId : int) : List<Inquiry>
  + readAll() : List<Inquiry>
  + update(inquiry : Inquiry) : void
  + delete(inquiryId : int) : void
}

class OfferMapper {
  + create(offer : Offer) : int
  + read(offerId : int) : Offer
  + readAll() : List<Offer>
  + update(offer : Offer) : void
  + delete(offerId : int) : void
}

class OrderMapper {
  + create(order : Order) : int
  + read(orderId : int) : Order
  + readByCustomerId(customerId : int) : List<Order>
  + readAll() : List<Order>
  + update(order : Order) : void
}

class MaterialMapper {
  + create(material : Material) : int
  + read(materialId : int) : Material
  + readAll() : List<Material>
  + readByType(type : MaterialType) : List<Material>
  + update(material : Material) : void
  + delete(materialId : int) : void
}

class CarportMapper {
  + create(carport : Carport) : int
  + read(carportId : int) : Carport
  + update(carport : Carport) : void
}

class BillOfMaterialsMapper {
  + create(bom : BillOfMaterials) : int
  + read(bomId : int) : BillOfMaterials
  + readByOfferId(offerId : int) : BillOfMaterials
  + update(bom : BillOfMaterials) : void
}

class MaterialLineMapper {
  + create(line : MaterialLine) : int
  + readByBomId(bomId : int) : List<MaterialLine>
  + update(line : MaterialLine) : void
  + delete(lineId : int) : void
}

class CarportDrawingMapper {
  + create(drawing : CarportDrawing) : int
  + read(drawingId : int) : CarportDrawing
  + readByOfferId(offerId : int) : CarportDrawing
}

interface IUserService
{
  + login(email : String, password : String) : User
  + register(user : User) : boolean
  + getUserById(userId : int) : User
}

interface IInquiryService
{

}

interface IOfferService
{

}

interface IOrderService {
  + getOrderById(orderId : int) : Order
  + getOrdersByCustomer(customerId : int) : List<Order>
  + getAllOrders() : List<Order>
  + confirmPayment(orderId : int) : boolean
  + closeOrder(orderId : int) : void
  + updateOrderStatus(orderId : int, status : OrderStatus) : void
}

interface IMaterialService {
  + addMaterial(material : Material) : int
  + getMaterialById(materialId : int) : Material
  + getAllMaterials() : List<Material>
  + getMaterialsByType(type : MaterialType) : List<Material>
  + updateMaterial(material : Material) : boolean
  + deleteMaterial(materialId : int) : boolean
}

interface INotificationService
{
}

interface ICarportService {
  + createCarport(carport : Carport) : int
  + getCarportById(carportId : int) : Carport
  + validateDimensions(carport : Carport) : boolean
}

interface IBillOfMaterialsService {
  + generateBillOfMaterials(carport : Carport) : BillOfMaterials
  + calculateMaterialsNeeded(carport : Carport) : List<MaterialLine>
  + getBillOfMaterialsById(bomId : int) : BillOfMaterials
  + updateBillOfMaterials(bom : BillOfMaterials) : void
}

interface ICarportDrawingService {
  + generateDrawing(carport : Carport) : CarportDrawing
  + getDrawingById(drawingId : int) : CarportDrawing
}

class InquiryController {
  - inquiryService : IInquiryService
  - carportService : ICarportService
  - notificationService : INotificationService
  + addRoutes(Javalin app)
}

class OfferController {
  - offerService : IOfferService
  - notificationService : INotificationService
    + addRoutes(Javalin app)
}

class OrderController {
  - orderService : IOrderService
  - notificationService : INotificationService
    + addRoutes(Javalin app)
}


class SellerController {
  - userService : IUserService
  - inquiryService : IInquiryService
  - offerService : IOfferService
  - orderService : IOrderService
    + addRoutes(Javalin app)
}

class CustomerController {
  - userService : IUserService
  - inquiryService : IInquiryService
  - offerService : IOfferService
  - orderService : IOrderService
  - notificationService : INotificationService
   + addRoutes(Javalin app)
}



class SendGridUtil {
  - {static} API_KEY : String
  - {static} TEMPLATE_INQUIRY_CONFIRMATION : String
  - {static} TEMPLATE_OFFER_READY : String
  - {static} TEMPLATE_OFFER_ACCEPTED : String
  + {static} sendEmail(to : String, templateId : String, email : Map) : boolean
}

class PriceCalculator {
  - {static} VAT_RATE : double
  - {static} coverageRate : double
  + {static} calculateCostPrice(materialLines : List<MaterialLine>) : double
  + {static} calculatePriceWithCoverage(costPrice : double, coverage : double) : double
  + {static} calculateWithVAT(price : double) : double
  + {static} createPrice(bom : BillOfMaterials, coverage : double) : Price
}

class PasswordUtil {
  + {static} hashPassword(password : String) : String
  + {static} verifyPassword(password : String, hash : String) : boolean
}

class ValidationUtil {
  + {static} validateEmail(email : String) : boolean
  + {static} validatePhoneNumber(phone : String) : boolean
  + {static} validateZipCode(zip : String) : boolean
  + {static} validateCarportDimensions(length : int, width : int, height : int) : boolean
}


User "1" *-- "1" Role


Inquiry "0..*" -- "1" User
Inquiry "1" *-- "1" Carport
Inquiry "1" -- "0..1" Offer


Offer "0..*" -- "1" Inquiry
Offer "0..*" -- "1" User
Offer "0..*" -- "1" User
Offer "1" *-- "1" Carport
Offer "1" *-- "1" BillOfMaterials
Offer "1" *-- "1" CarportDrawing
Offer "1" *-- "1" OfferDate
Offer <-- OfferStatus


Order "0..*" -- "1" User
Order "1" -- "1" Offer
Order "1" *-- "1" BillOfMaterials
Order <-- OrderStatus


Carport "1" *-- "1" RoofType
Carport "1" *-- "0..1" Shed


Shed "1" *-- "1" ShedPlacement

BillOfMaterials "1" *-- "1..*" MaterialLine
BillOfMaterials "1" *-- "1" PricingDetails
MaterialLine "0..*" -- "1" Material

Material "1" *-- "1" MaterialType
Material "1" *-- "1" MaterialCategory

CarportSvg <|.. CarportTopSvg
CarportSvg <|.. CarportSideSvg
CarportTopSvg ..> Svg
CarportSideSvg ..> Svg


IUserService ..> UserMapper
IInquiryService ..> InquiryMapper
IInquiryService ..> CarportMapper
IOfferService ..> OfferMapper
IOfferService ..> BillOfMaterialsMapper
IOfferService ..> CarportDrawingMapper
IOrderService ..> OrderMapper
IMaterialService ..> MaterialMapper
ICarportService ..> CarportMapper
IBillOfMaterialsService ..> BillOfMaterialsMapper
IBillOfMaterialsService ..> MaterialLineMapper
IBillOfMaterialsService ..> MaterialMapper
ICarportDrawingService ..> CarportDrawingMapper

INotificationService ..> SendprGridUtil
IOfferService ..> PriceCalculator
IBillOfMaterialsService ..> PriceCalculator
IUserService ..> PasswordUtil
IInquiryService ..> ValidationUtil
IUserService ..> ValidationUtil
ICarportService ..> ValidationUtil

ICarportDrawingService ..> CarportSvg

InquiryController --> IInquiryService
InquiryController --> ICarportService
InquiryController --> INotificationService
OfferController --> IOfferService
OfferController --> INotificationService
OrderController --> IOrderService
OrderController --> INotificationService
SellerController --> IInquiryService
SellerController --> IOfferService
SellerController --> IOrderService
CustomerController --> IInquiryService
CustomerController --> IOfferService
CustomerController --> IOrderService
CustomerController --> IUserService
CustomerController --> INotificationService


@enduml
