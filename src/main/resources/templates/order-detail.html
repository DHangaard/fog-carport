<!DOCTYPE html>
<html lang="da" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Fog - Ordre detaljer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link rel="stylesheet" th:href="@{/css/styles.css}"/>
    <link rel="icon" th:href="@{/images/logo.svg}">
</head>
<body>

<div th:replace="~{fragments :: headerFragment}"></div>

<main>
    <div class="request-details-page">
        <div th:if="${successMessage}" class="message message-success">
            <p th:text="${successMessage}"></p>
        </div>

        <div th:if="${errorMessage}" class="message message-error">
            <p th:text="${errorMessage}"></p>
        </div>
        <div class="hero-content">
            <div class="hero-p-and-order-info">
                <div th:if="${session.currentUser.role.name() != 'SALESREP'}">
                    <p class="bold-text">Kære <span th:text="${orderDetail.customer.firstName}">NAVN</span>,</p>
                    <p>Tillykke med dit nye køb hos Fog.
                        Vi sætter pris på din tillid til vores kvalitetsløsninger og arbejde “med omtanke”.<br>
                        Leveringen af din carport aftales direkte med vores sælger, og du vil modtage en separat henvendelse herom.
                        Ønsker du hjælp til opsætning, kan vi formidle kontakt til en entreprenør,
                        så installationen foregår trygt og professionelt.
                        Sælgerens kontaktoplysninger fremgår af fakturaen, hvis du har yderligere spørgsmål.
                    </p>
                </div>
                <div class="order-info-box">
                    <p class=bold-text>Ordre #<span th:text="${orderDetail.orderId}"></span></p>
                    <p>Oprettet : <span th:text="${orderDetail.orderTimeLine.relativeTime}"></span></p>
                    <p>Status : <span class="bold-text" th:text="${orderDetail.orderStatus.displayName}"></span></p>
                </div>
            </div>
        </div>

        <section class="section">
            <h2>Carport & kunde information</h2>

            <div class="info">

                <div class="info-content">
                    <h3>Carport Specifikationer</h3>
                    <div class="info-item">
                        <strong>Længde:</strong>
                        <span th:text="${orderDetail.carport.length} + ' cm'"></span>
                    </div>
                    <div class="info-item">
                        <strong>Bredde:</strong>
                        <span th:text="${orderDetail.carport.width} + ' cm'"></span>
                    </div>
                    <div class="info-item">
                        <strong>Tagtype:</strong>
                        <span th:text="${orderDetail.carport.roofType.displayName}"></span>
                    </div>
                    <div class="info-item" th:if="${orderDetail.carport.shed != null}">
                        <strong>Skur:</strong>
                        <span th:text="${orderDetail.carport.shed.length} + ' x ' + ${orderDetail.carport.shed.width} + ' cm'"></span>
                    </div>
                </div>

                <div class="info-content">
                    <h3>Kunde information</h3>

                    <div class="info-item">
                        <strong>Navn:</strong>
                        <span th:text="${orderDetail.customer.firstName} + ' ' + ${orderDetail.customer.lastName}"></span>
                    </div>

                    <div class="info-item">
                        <strong>E-mail:</strong>
                        <a th:href="'mailto:' + ${orderDetail. customer.email}"
                           th:text="${orderDetail.customer.email}"></a>
                    </div>

                    <div class="info-item">
                        <strong>Telefon:</strong>
                        <a th:href="'tel:+45' + ${orderDetail.customer.phoneNumber}"
                           th:text="${orderDetail.customer.phoneNumber}"></a>
                    </div>

                    <div class="info-item">
                        <strong>Adresse:</strong>
                        <span th:text="${orderDetail.customer.street} + ', ' + ${orderDetail.customer.zipCode} + ' ' + ${orderDetail.customer.city}"></span>
                    </div>

                    <div th:if="${orderDetail.customerComment}" class="info-item">
                        <strong>Kommentar:</strong>
                        <span th:text="${orderDetail.customerComment}"></span>
                    </div>
                </div>
            </div>

            <div class="info">
                <div class="info-content">
                    <h2>Sælger information - kontakt ved spørgsmål</h2>
                    <div class="info-item">
                        <strong>Navn:</strong> <span th:text="${orderDetail.seller.firstName} + ' ' + ${orderDetail.seller.lastName}"></span>
                    </div>
                    <div class="info-item">
                        <strong>E-mail:</strong> <a th:href="'mailto:' + ${orderDetail.seller.email}" th:text="${orderDetail.seller.email}"></a>
                    </div>
                    <div class="info-item" th:if="${orderDetail.seller.phoneNumber != null}">
                        <strong>Telefon:</strong> <a th:href="'tel:+45' + ${orderDetail.seller.phoneNumber}" th:text="${orderDetail.seller.phoneNumber}"></a>
                    </div>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Tegning</h2>
            <div class="drawing-grid">
                <div class="carport-svg-topview-small">
                    <h3>Oversigt fra toppen</h3>
                    <div th:utext="${carportSvgTop.toString()}"></div>
                </div>
                <div class="carport-svg-sideview-small">
                    <h3>Sidevisning</h3>
                    <div th:utext="${carportSvgSide.toString()}"></div>
                </div>
            </div>

            <a th:href="@{/show-carport-drawing/{id}(id=${orderDetail.orderId})}" class=" btn btn-primary" target="_blank"
               rel="noopener noreferrer">Se stor tegning her</a>
        </section>

        <section class="section">
            <h2>Stykliste</h2>

            <table class="orders-table">
                <thead>
                <tr>
                    <th>Antal</th>
                    <th>Vare nr.</th>
                    <th>Vare beskrivelse</th>
                    <th>Hjælpe tekst</th>
                    <th>Længde</th>
                    <th>Bredde</th>
                    <th>Højde</th>
                    <th>Enhed</th>
                    <th>Stk. per enhed</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="line : ${orderDetail.materialLines}">
                    <td th:text="${line.quantity}"></td>
                    <td th:text="${line.materialVariant.materialVariantId}"></td>
                    <td th:text="${line.materialVariant.material.description}"></td>
                    <td th:text="${line.materialVariant.material.usage}"></td>
                    <td th:text="${line.materialVariant.variantLength != null ? line.materialVariant.variantLength + ' cm' : '-'}"></td>
                    <td th:text="${line.materialVariant.material.materialWidth != null ? line.materialVariant.material.materialWidth + ' mm' : '-'}"></td>
                    <td th:text="${line.materialVariant.material.materialHeight != null ? line.materialVariant.material.materialHeight + ' mm' : '-'}"></td>
                    <td th:text="${line.materialVariant.material.unit}"></td>
                    <td th:text="${line.materialVariant.piecesPerUnit}"></td>
                </tr>
                </tbody>
            </table>
        </section>

        <section class="section">
            <h2>Pris oversigt</h2>
            <div class="price-overview-grid">

            <div class="price-summary-box">
             <h3>Total pris med og uden moms</h3>
                <div class="price-row">
                    <span class="price-label">Pris uden moms:</span>
                    <div class="price-amount">
                        <span class="price-display"
                              th:text="${orderDetail.pricingDetails.formattedPriceWithoutVat}"></span>
                        <span class="unit">kr.</span>
                    </div>
                </div>

                <hr class="horizontal-line">
                <div class="price-row">
                    <span class="price-label">Total pris:</span>
                    <div class="price-amount">
                        <span class="price-display"
                              th:text="${orderDetail.pricingDetails.formattedTotalPrice}"></span>
                        <span class="unit">kr.</span>
                    </div>
                </div>
            </div>

                <div th:if="${session.currentUser.role.name() == 'SALESREP'}" class="price-summary-box">
                <h3>Dækningsgrad og fortjeneste</h3>
                    <div class="price-row">
                        <span class="price-label">Kostpris:</span>
                        <div class="price-amount">
                        <span class="price-display"
                              th:text="${orderDetail.pricingDetails.formattedCostPrice}"></span>
                        <span class="unit">kr.</span>
                        </div>
                    </div>

                    <div class="price-row">
                        <span class="price-label">Dækningsgrad:</span>
                        <div class="price-amount">
                          <span class="price-display"
                          th:text="${orderDetail.pricingDetails.formattedCoveragePercentage}"></span>
                            <span class="unit">%</span>
                        </div>
                    </div>

                    <div class="price-row">
                        <span class="price-label">Fortjeneste uden moms:</span>
                        <div class="price-amount">
                    <span class="price-display"
                          th:text="${orderDetail.pricingDetails.formattedProfit}"></span>
                            <span class="unit">kr.</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
</main>

<div th:replace="~{fragments :: footerFragment}"></div>
</body>
</html>
